# 薛定谔的山芋 (Schrödinger's Potato) 🥔

这是一个基于区块链的高风险、高回报的概率博弈游戏。核心玩法围绕着一个独特的 NFT——“山芋”的传递展开。玩家的目标是在山芋爆炸前尽可能久地持有它以赚取收益，或者成为那群因持有时间长而从奖池中分得 ETH 的“幸存者”之一。

---

## 核心概念

-   **山芋 (The Potato)**: 这是一个独一无二的 ERC721 NFT (Token ID 为 1)。拥有这个 NFT，意味着你就是当前的山芋持有者。

-   **收益代币 (`$PYT`)**: 这是一种 ERC20 代币。你持有山芋的每一秒（基于 `block.timestamp` 的时间流逝），都在为你累积 `$PYT` 代币。

-   **大奖池 (The Jackpot)**: 这是一个 ETH 奖池。每次传递山芋都需要支付一笔固定的 ETH“入场费”，这笔费用会全部进入奖池。游戏结束后，奖池会根据**所有前持有者**在当前游戏轮次中持有山芋的时间**按比例分配**。

-   **风险 (The Risk)**: 你持有山芋的时间越长，当你尝试传递它时，它“爆炸”的概率就越高。这种概率会根据合约预设的阶梯模型**疯狂变高**，比如持有超过一天，爆炸几率甚至可能达到 60% 或更高！

---

## 🎮 游戏玩法 (Game Loop)

游戏围绕着“持有”和“投掷”两个核心动作展开。

### 1. 成为持有者
当别人向你投掷山芋，并且山芋安全着陆时，你就成为了新的持有者。

### 2. 持有山芋
当你持有山芋时：
-   你的 `$PYT` 收益代币正在**每秒钟**不断累积。你可以随时调用 `calculatePendingYield()` 函数来查看当前累积的待领取收益。
-   与此同时，山芋的爆炸风险也在随时间增长。

### 3. 投掷山芋
-   要传递山芋，你需要调用 `tossPotato(address _to)` 函数，并指定接收者。
-   调用此函数时，你必须支付一笔固定的 ETH **入场费 (entryFee)**。这笔费用会进入大奖池。
-   **注意：** 这个操作是**异步**的。它不会立即转移山芋，而是将山芋置于“飞行中 (`InFlight`)”状态，等待结算。

### 4. 结算投掷
在一次投掷发生后，**任何人**都可以调用 `resolveToss()` 函数来“开奖”，揭晓山芋的命运。
-   合约会使用 `blockhash(tossBlockNumber + 1)` 来生成一个伪随机数。
-   这个随机数将与你持有山芋时长所对应的风险值进行比较，产生两种结果：

#### **关于随机性与预测**
请注意，Solidity 中的 `blockhash` 虽然常用于生成随机数，但它是**伪随机的**，且**对矿工是可见和可预测的**。这意味着，一个技术高超的“疯狂科学家”或矿工，理论上可以通过计算预期的区块哈希值，来预测 `resolveToss()` 的结果。为了增加游戏的公平性（和博弈性），`resolveToss()` 可由**任何人**调用，这引入了一个“Keeper”机器人或抢跑（front-running）的竞争，大家都在争夺成为第一个结算交易的人，以影响或利用结果。

#### **结果 ①：安全着陆！ ✅**
-   **条件：** 随机数**大于**你的风险阈值。
-   **结果：**
    1.  山芋 NFT 安全转移给新的持有者。
    2.  你（作为投掷者）将获得你持有期间累积的所有 `$PYT` 收益代币。
    3.  你贡献的持有时间将被计入奖池分配的考量。

#### **结果 ②：山芋爆炸！ 💥**
-   **条件：** 随机数**小于**你的风险阈值（或者超过 256 个区块仍未结算）。
-   **结果：**
    1.  山芋 NFT 被**销毁**，游戏结束。
    2.  你（作为当前持有者）**无法获得**任何累积的 `$PYT` 收益，所有待领取的收益都将归零。
    3.  奖池进入开放领取状态。所有在本轮游戏中**持有过山芋的玩家，都可以根据其累积的持有时间比例，调用 `claimJackpotShare()` 函数来领取奖池中的 ETH。**

---

## 📈 策略与博弈

-   **贡献时间，而非幸存**: 你的目标是尽可能长时间地持有山芋，以便在游戏结束时从奖池中获得更大的份额，而不是仅仅成为“最后一个幸存者”。
-   **平衡风险与收益**: 持有时间越长，虽然在爆炸时能从奖池中分得更多，但你自己的 `$PYT` 收益也可能在爆炸时作废。
-   **及时领取**: 游戏结束后，请及时调用 `claimJackpotShare()` 领取你的奖金。

这是一个在稳定收益和巨额大奖之间进行权衡的经典博弈，但现在更强调**对游戏总体的贡献**。祝你好运！