# ğŸ¥” â€œè–›å®šè°”çš„å±±èŠ‹â€é¡¹ç›®å¼€å‘
---

### **é¡¹ç›®æ¨¡å—ä¸æ¶æ„**

1.  **æ ¸å¿ƒåˆçº¦ (`src/Potato.sol`)**:
    *   è¿™å°†æ˜¯é¡¹ç›®çš„å”¯ä¸€æ ¸å¿ƒåˆçº¦ã€‚å®ƒå°†æ˜¯ä¸€ä¸ª `ERC721` æ ‡å‡†çš„ NFTã€‚è¿™ä¸ª NFT æœ¬èº«å°±æ˜¯é‚£ä¸ªâ€œå±±èŠ‹â€ã€‚
    *   æˆ‘ä»¬å°†åœ¨è¯¥åˆçº¦ä¸­é›†æˆæ‰€æœ‰æ¸¸æˆé€»è¾‘ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬åˆ†æ•£åˆ°å¤šä¸ªåˆçº¦ä¸­ã€‚è¿™æ ·å¯ä»¥ç®€åŒ–äº¤äº’å¹¶é™ä½ Gas æˆæœ¬ã€‚
    *   **ç»§æ‰¿**ï¼šåˆçº¦å°†ç»§æ‰¿è‡ª OpenZeppelin çš„ `ERC721`ï¼ˆç”¨äºå®ç° NFT åŠŸèƒ½ï¼‰å’Œ `Ownable`ï¼ˆç”¨äºç®¡ç†åˆçº¦çš„ç‰¹æ®Šæƒé™ï¼Œå¦‚è®¾ç½®æ¸¸æˆå‚æ•°ï¼‰ã€‚

2.  **åˆçº¦å†…éƒ¨æ¨¡å—åˆ’åˆ† (é€»è¾‘å±‚é¢)**:
    *   **æ•°æ®ç»“æ„ (State & Structs)**: `GameState` æšä¸¾, `GameInfo` ç»“æ„ä½“ï¼Œä»¥åŠæ‰€æœ‰äº‹ä»¶ (`Event`) çš„å®šä¹‰ã€‚è¿™æ˜¯åˆçº¦çŠ¶æ€çš„åŸºç¡€ã€‚
    *   **æ ¸å¿ƒæ¸¸æˆé€»è¾‘ (Core Logic)**: `tossPotato` å’Œ `resolveToss` å‡½æ•°ã€‚è¿™æ˜¯æ¸¸æˆç©æ³•çš„å¿ƒè„ã€‚
    *   **ç»æµæ¨¡å‹ (Tokenomics)**: `calculatePendingYield` è§†å›¾å‡½æ•°å’Œåœ¨ `resolveToss` ä¸­é›†æˆçš„å¥–åŠ±/æƒ©ç½šé€»è¾‘ã€‚
    *   **è¾…åŠ©/å·¥å…·å‡½æ•° (Utils)**: å¦‚ `_calculateRisk` è¿™æ ·çš„å†…éƒ¨çº¯å‡½æ•°ï¼Œç”¨äºè®¡ç®—çˆ†ç‚¸æ¦‚ç‡ã€‚

3.  **æ–‡ä»¶ç»“æ„ (ç‰©ç†å±‚é¢)**:
    *   `src/Potato.sol`: æ ¸å¿ƒåˆçº¦æ–‡ä»¶ã€‚
    *   `test/Potato.t.sol`: Foundry æµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•æ‰€æœ‰åŠŸèƒ½ã€‚
    *   `script/Deploy.s.sol`: Foundry éƒ¨ç½²è„šæœ¬ã€‚
    *   `script/interactions/`: å­˜æ”¾åæœŸäº¤äº’è„šæœ¬çš„ç›®å½•ï¼ˆå¦‚ `play.ts`, `keeper-bot.ts`ï¼‰ã€‚

---

# ğŸ¥” é¡¹ç›®å¼€å‘å¾…åŠæ¸…å• (Project To-Do List)

**é¡¹ç›®æ ¸å¿ƒï¼š** åŸºäºåŒºå—å“ˆå¸Œå»¶æ—¶ç»“ç®—çš„æ¦‚ç‡åšå¼ˆæ¸¸æˆã€‚
**æŠ€æœ¯æ ˆï¼š** Solidity (Hardhat/Foundry), TypeScript (ç”¨äºè„šæœ¬äº¤äº’)ã€‚

---

### é˜¶æ®µä¸€ï¼šæ¶æ„ä¸æ•°æ®ç»“æ„è®¾è®¡ (Architecture Design)
**ç›®æ ‡ï¼š** ç¡®ç«‹çŠ¶æ€æœºã€å­˜å‚¨ç»“æ„å’Œäº‹ä»¶æ¥å£ï¼Œè¿™æ˜¯â€œæ— å‰ç«¯â€ç©æ³•çš„æ ¸å¿ƒã€‚

*   [ ] **1.1 å®šä¹‰æ ¸å¿ƒç»“æ„ä½“ä¸çŠ¶æ€æœº**
    *   è®¾è®¡ `GameState` (è®°å½•å±±èŠ‹ä½ç½®ã€æ—¶é—´)ã€‚
    *   è®¾è®¡ `TossRequest` (è®°å½•æŠ•æ·åŠ¨ä½œçš„å¿«ç…§)ã€‚
    *   è®¾è®¡ `Enum State` (`Idle`, `InFlight`)ã€‚
*   [ ] **1.2 å®šä¹‰äº‹ä»¶ (Events)**
    *   å› ä¸ºæ²¡æœ‰å‰ç«¯ï¼ŒEvents å¿…é¡»æ¸…æ™°ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨ Etherscan ä¸Šçœ‹ Log ç©æ¸¸æˆã€‚
    *   éœ€è¦ï¼š`PotatoTossed`, `PotatoExploded`, `PotatoLanded`, `YieldClaimed`.

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒé€»è¾‘å¼€å‘ (Core Development)
**ç›®æ ‡ï¼š** å®ç°â€œæŠ•æ·-æ­æ™“â€çš„å¼‚æ­¥é€»è¾‘å’Œæ¦‚ç‡ç®—æ³•ã€‚

*   [ ] **2.1 å®ç° `tossPotato` (åŠ¨ä½œå±‚)**
    *   ç¼–å†™æƒé™æ£€æŸ¥ï¼šåªæœ‰å½“å‰æŒæœ‰äººèƒ½è°ƒã€‚
    *   ç¼–å†™çŠ¶æ€é”å®šï¼šä» `Idle` å˜æ›´ä¸º `InFlight`ï¼Œè®°å½•å½“å‰åŒºå—é«˜åº¦ã€‚
*   [ ] **2.2 å®ç°æ¦‚ç‡è®¡ç®—å™¨ (æ•°å­¦å±‚)**
    *   ç¼–å†™ `_calculateRisk(uint256 holdTime)` çº¯å‡½æ•°ã€‚
    *   è¾“å…¥æŒæœ‰ç§’æ•°ï¼Œè¿”å› 5, 30, 60, æˆ– 100 (çˆ†ç‚¸ç™¾åˆ†æ¯”)ã€‚
*   [ ] **2.3 å®ç° `resolveToss` (ç»“ç®—å±‚)**
    *   **éš¾ç‚¹ï¼š** è·å– `blockhash(tossBlock + 1)`ã€‚
    *   **é€»è¾‘ï¼š** ç”Ÿæˆä¼ªéšæœºæ•° -> å¯¹æ¯”é£é™©å€¼ -> æ‰§è¡Œï¼ˆè½¬ç§» NFT æˆ– ç‚¸æ¯ï¼‰ã€‚
    *   **é˜²æ­»é”ï¼š** å¤„ç† 256 ä¸ªåŒºå—åå“ˆå¸Œæ— æ³•è·å–çš„æƒ…å†µï¼ˆåˆ¤å®šä¸ºè‡ªåŠ¨çˆ†ç‚¸ï¼‰ã€‚

### é˜¶æ®µä¸‰ (é‡æ„): æ–°çš„å¥–æ± åˆ†é…ç­–ç•¥
**ç›®æ ‡:** å°† "èµ¢å®¶é€šåƒ" çš„å¥–æ± æ¨¡å‹é‡æ„ä¸ºæŒ‰æŒæœ‰æ—¶é—´æ¯”ä¾‹åˆ†é…ç»™æ‰€æœ‰å‰æŒæœ‰è€…çš„æ¨¡å‹ï¼Œå¹¶ç¡®ä¿å…¶å®‰å…¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚

*   [ ] **3.R.1: å‡çº§æ•°æ®ç»“æ„**
    *   ç§»é™¤ `GameInfo` ä¸­çš„ `lastSuccessfulTosser` å­—æ®µã€‚
    *   æ–°å¢ `mapping(address => uint256) public accumulatedHoldTime;`ï¼Œç”¨äºè®°å½•æ¯ä¸ªåœ°å€çš„æ€»æŒæœ‰æ—¶é—´ã€‚
    *   æ–°å¢ `uint256 public totalHoldTimeInRound;`ï¼Œè®°å½•æœ¬è½®æ¸¸æˆç´¯ç§¯çš„æ€»æŒæœ‰æ—¶é—´ã€‚
    *   æ–°å¢ `mapping(address => bool) public hasClaimedJackpot;`ï¼Œé˜²æ­¢é‡å¤é¢†å–å¥–é‡‘ã€‚
    *   æ–°å¢ `uint256 public finalJackpot;` å’Œ `bool public isClaimingOpen;`ï¼Œç”¨äºæ ‡è®°æ¸¸æˆç»“æŸå’Œå¥–é‡‘æ± çŠ¶æ€ã€‚

*   [ ] **3.R.2: ä¿®æ”¹ `resolveToss` (å®‰å…¨ç€é™†)**
    *   å½“å±±èŠ‹å®‰å…¨ç€é™†æ—¶ï¼Œè®¡ç®— `holdTime`ã€‚
    *   å°† `holdTime` æ·»åŠ åˆ° `accumulatedHoldTime[from]` å’Œ `totalHoldTimeInRound` ä¸­ã€‚

*   [ ] **3.R.3: ä¿®æ”¹ `resolveToss` (çˆ†ç‚¸)**
    *   å½“å±±èŠ‹çˆ†ç‚¸æ—¶ï¼š
        *   ä¸å†ç«‹å³æ”¯ä»˜å¥–é‡‘ã€‚
        *   è®°å½• `finalJackpot = address(this).balance`ã€‚
        *   è®¾ç½® `isClaimingOpen = true`ã€‚
        *   é‡ç½®æ¸¸æˆçŠ¶æ€ï¼Œä¸ºå¯èƒ½çš„ä¸‹ä¸€è½®æ¸¸æˆåšå‡†å¤‡ï¼ˆæˆ–æ°¸ä¹…ç»“æŸï¼‰ã€‚

*   [ ] **3.R.4: å®ç° `claimJackpotShare()` (æ ¸å¿ƒ)**
    *   ç¼–å†™ä¸€ä¸ªæ–°çš„å¤–éƒ¨å‡½æ•° `claimJackpotShare()`ã€‚
    *   å‡½æ•°é€»è¾‘ï¼š
        *   `require(isClaimingOpen, "Claiming is not open.");`
        *   `require(!hasClaimedJackpot[msg.sender], "Already claimed.");`
        *   è®¡ç®—ä»½é¢ï¼š `uint256 share = (finalJackpot * accumulatedHoldTime[msg.sender]) / totalHoldTimeInRound;`
        *   **å…ˆæ›´æ–°çŠ¶æ€ï¼Œå†è½¬è´¦ï¼ˆé˜²é‡å…¥æ”»å‡»ï¼‰**: è®¾ç½® `hasClaimedJackpot[msg.sender] = true;`
        *   å‘ `msg.sender` å‘é€ `share` æ•°é‡çš„ ETHã€‚

*   [ ] **3.R.5: æ›´æ–°æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹**
    *   é‡å†™ `test_jackpotPayout_onExplosion` æ¥æµ‹è¯•æ–°çš„ `claimJackpotShare` é€»è¾‘ã€‚
    *   ç¡®ä¿æ‰€æœ‰ä¸ `resolveToss` ç›¸å…³çš„æµ‹è¯•éƒ½æ›´æ–°ä»¥åæ˜ æ–°çš„çŠ¶æ€å˜åŒ–ã€‚

### é˜¶æ®µå››ï¼šæµ‹è¯•ä¸æ”»é˜² (Testing & Security)
**ç›®æ ‡ï¼š** æ¨¡æ‹Ÿå„ç§æç«¯æƒ…å†µï¼Œç¡®ä¿åšå¼ˆå…¬å¹³ã€‚

*   [ ] **4.1 åŸºç¡€æµç¨‹æµ‹è¯•**
    *   A ä¼ ç»™ Bï¼ŒB ä¼ ç»™ Cï¼Œæ­£å¸¸æµè½¬ã€‚
*   [ ] **4.2 æ¦‚ç‡åˆ†å¸ƒæµ‹è¯• (Fuzzing)**
    *   æ¨¡æ‹Ÿ 1000 æ¬¡ `resolveToss`ï¼ŒéªŒè¯ 5%, 30%, 60% çš„çˆ†ç‚¸ç‡æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
*   [ ] **4.3 è¾¹ç•Œæ¡ä»¶æµ‹è¯•**
    *   æµ‹è¯•åœ¨åŒä¸€ä¸ªåŒºå—å†…è¿ç»­è°ƒç”¨ï¼ˆåº”è¯¥è¢« ReentrancyGuard æˆ– çŠ¶æ€æœºæ‹¦æˆªï¼‰ã€‚
    *   æµ‹è¯•è¶…è¿‡ 256 ä¸ªåŒºå—æ²¡äººå¼€å¥–çš„æƒ…å†µã€‚

### é˜¶æ®µäº”ï¼šæå®¢äº¤äº’è„šæœ¬ (æ›´æ–°ç‰ˆ)
**ç›®æ ‡ï¼š** æä¾›å‘½ä»¤è¡Œå·¥å…·æ¥ä¸é‡æ„åçš„åˆçº¦äº¤äº’ã€‚

*   [ ] **5.1 `status.js` (çŠ¶æ€æŸ¥è¯¢è„šæœ¬)**
    *   æŸ¥è¯¢å½“å‰å±±èŠ‹æŒæœ‰äººã€æŒæœ‰æ—¶é—´ã€å³æ—¶çˆ†ç‚¸æ¦‚ç‡ã€‚
    *   æŸ¥è¯¢å¥–æ± æ€»é‡‘é¢ (`finalJackpot`) å’Œä¸ªäººå¯é¢†å–ä»½é¢ã€‚
*   [ ] **5.2 `play.js` (æ¸¸æˆæ“ä½œè„šæœ¬)**
    *   ä¸€é”®è°ƒç”¨ `tossPotato` å¹¶æ”¯ä»˜ `entryFee`ã€‚
    *   ä¸€é”®è°ƒç”¨ `resolveToss`ã€‚
    *   ä¸€é”®è°ƒç”¨ `claimJackpotShare` æ¥é¢†å–è‡ªå·±çš„å¥–é‡‘ã€‚